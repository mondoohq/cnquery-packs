packs:
  - uid: mondoo-asset-inventory-terraform-aws
    name: Terraform AWS Asset Inventory Pack
    version: 1.0.0
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: aws,cloud,terraform
      mondoo.com/category: asset-inventory
    docs:
      desc: |
        This inventory collects data from AWS Terraform state files and AWS accounts to build an asset inventory of resources managed by Terraform. 
    groups:
      - title: AWS Terraform Inventory 
        filters: asset.platform == "terraform-state" && terraform.state.resources.any( providerName == "registry.terraform.io/hashicorp/aws" )
        checks:
          - uid: mondoo-asset-inventory-aws-default-network-acl
          - uid: mondoo-asset-inventory-aws-default-route-table
          - uid: mondoo-asset-inventory-aws-default-security-group
          - uid: mondoo-asset-inventory-aws-internet-gateway
    queries:
      - uid: mondoo-asset-inventory-aws-default-network-acl
        title: AWS Default Network ACLs 
        mql: terraform.state.resources.where( type == "aws_default_network_acl" ) { values['arn'] }
      - uid: mondoo-asset-inventory-aws-default-route-table
        title: AWS default route tables 
        mql: terraform.state.resources.where( type == "aws_default_route_table" ) { values['arn'] }
      - uid: mondoo-asset-inventory-aws-default-security-group
        title: AWS Default security group 
        mql: terraform.state.resources.where( type == "aws_default_security_group" ) { values['arn'] }
      - uid: mondoo-asset-inventory-aws-internet-gateway
        title: AWS Internet Gateways
        mql: terraform.state.resources.where( type == "aws_internet_gateway" ) { values['arn'] }